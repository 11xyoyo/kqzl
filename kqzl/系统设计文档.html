<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç©ºæ°”è´¨é‡ç›‘æµ‹ç³»ç»Ÿ - è¯¦ç»†è®¾è®¡æ–‡æ¡£</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    <style>
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
        }
        h2 {
            color: #34495e;
            border-left: 4px solid #3498db;
            padding-left: 15px;
            margin-top: 30px;
        }
        h3 {
            color: #2980b9;
            margin-top: 25px;
        }
        .module {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        .flowchart {
            background: white;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 15px;
            margin: 15px 0;
            text-align: center;
        }
        .data-structure {
            background: #e8f4f8;
            border-left: 4px solid #17a2b8;
            padding: 15px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
        }
        .api-info {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 5px;
            padding: 15px;
            margin: 10px 0;
        }
        .tech-stack {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .tech-item {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #2196f3;
        }
        .warning {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        code {
            background: #f1f1f1;
            padding: 2px 5px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
        }
        pre {
            background: #f8f8f8;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 15px;
            overflow-x: auto;
        }
        .toc {
            background: #f0f0f0;
            border: 1px solid #ccc;
            border-radius: 5px;
            padding: 20px;
            margin: 20px 0;
        }
        .toc ul {
            list-style-type: none;
            padding-left: 20px;
        }
        .toc a {
            text-decoration: none;
            color: #2980b9;
        }
        .toc a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸŒ¬ï¸ ç©ºæ°”è´¨é‡ç›‘æµ‹ç³»ç»Ÿ - è¯¦ç»†è®¾è®¡æ–‡æ¡£</h1>
        
        <div class="toc">
            <h2>ğŸ“‹ ç›®å½•</h2>
            <ul>
                <li><a href="#overview">1. ç³»ç»Ÿæ¦‚è¿°</a></li>
                <li><a href="#architecture">2. ç³»ç»Ÿæ¶æ„</a></li>
                <li><a href="#modules">3. æ ¸å¿ƒæ¨¡å—è®¾è®¡</a>
                    <ul>
                        <li><a href="#data-collection">3.1 ä¼ æ„Ÿå™¨æ•°æ®é‡‡é›†æ¨¡å—</a></li>
                        <li><a href="#communication">3.2 æ•°æ®é€šä¿¡æ¨¡å—</a></li>
                        <li><a href="#data-upload">3.3 æ•°æ®ä¸Šä¼ æ¨¡å—</a></li>
                        <li><a href="#ai-analysis">3.4 AIé—®ç­”æµç¨‹æ¨¡å—</a></li>
                        <li><a href="#alarm-logic">3.5 æŠ¥è­¦é€»è¾‘æ¨¡å—</a></li>
                        <li><a href="#chart-display">3.6 å›¾è¡¨æ˜¾ç¤ºæ¨¡å—</a></li>
                    </ul>
                </li>
                <li><a href="#data-structures">4. æ•°æ®ç»“æ„å®šä¹‰</a></li>
                <li><a href="#api-interfaces">5. APIæ¥å£è®¾è®¡</a></li>
                <li><a href="#tech-stack">6. æŠ€æœ¯æ ˆè¯¦è§£</a></li>
            </ul>
        </div>

        <section id="overview">
            <h2>1. ç³»ç»Ÿæ¦‚è¿°</h2>
            <p>ç©ºæ°”è´¨é‡ç›‘æµ‹ç³»ç»Ÿæ˜¯ä¸€ä¸ªåŸºäºUniAppå¼€å‘çš„æ™ºèƒ½ç¯å¢ƒç›‘æµ‹åº”ç”¨ï¼Œé›†æˆäº†å®æ—¶æ•°æ®é‡‡é›†ã€å†å²æ•°æ®åˆ†æã€AIæ™ºèƒ½åˆ†æå’Œå¯è§†åŒ–å±•ç¤ºç­‰åŠŸèƒ½ã€‚ç³»ç»Ÿé€šè¿‡åä¸ºäº‘IoTå¹³å°è·å–ä¼ æ„Ÿå™¨æ•°æ®ï¼Œç»“åˆAIæŠ€æœ¯æä¾›ä¸“ä¸šçš„ç¯å¢ƒåˆ†æå’Œå»ºè®®ã€‚</p>
            
            <div class="success">
                <strong>æ ¸å¿ƒåŠŸèƒ½ï¼š</strong>
                <ul>
                    <li>ğŸŒ¡ï¸ å®æ—¶ç›‘æµ‹æ¸©åº¦ã€æ¹¿åº¦ã€PM2.5ã€ç”²é†›ã€VOCã€ç´«å¤–çº¿ã€å™ªéŸ³ç­‰ç¯å¢ƒå‚æ•°</li>
                    <li>ğŸ“Š å¤šç»´åº¦æ•°æ®å¯è§†åŒ–å’Œå†å²è¶‹åŠ¿åˆ†æ</li>
                    <li>ğŸ¤– AIæ™ºèƒ½åˆ†æå’Œä¸“ä¸šå»ºè®®</li>
                    <li>ğŸ—ºï¸ è®¾å¤‡ä½ç½®ç›‘æ§å’Œåœ°å›¾æ˜¾ç¤º</li>
                    <li>âš ï¸ æ™ºèƒ½æŠ¥è­¦å’Œé˜ˆå€¼ç›‘æµ‹</li>
                </ul>
            </div>
        </section>

        <section id="architecture">
            <h2>2. ç³»ç»Ÿæ¶æ„</h2>
            <div class="flowchart">
                <div class="mermaid">
                graph TB
                    A[å‰ç«¯åº”ç”¨ UniApp] --> B[uniCloudäº‘æœåŠ¡]
                    B --> C[åä¸ºäº‘IoTå¹³å°]
                    C --> D[ä¼ æ„Ÿå™¨è®¾å¤‡]
                    B --> E[äº‘æ•°æ®åº“]
                    A --> F[AIæœåŠ¡ DeepSeek]
                    A --> G[åœ°å›¾æœåŠ¡]
                    
                    subgraph "å‰ç«¯æ¨¡å—"
                        A1[ä¸»é¡µé¢ index.vue]
                        A2[å›¾è¡¨é¡µé¢ Charts.vue]
                        A3[AIåˆ†æé¡µé¢ ai.vue]
                        A4[å›¾è¡¨ç»„ä»¶ aichart.vue]
                    end
                    
                    subgraph "äº‘å‡½æ•°"
                        B1[getToken - è·å–è®¤è¯ä»¤ç‰Œ]
                        B2[getDeviceData - è·å–è®¾å¤‡æ•°æ®]
                        B3[getHistoryData - è·å–å†å²æ•°æ®]
                    end
                    
                    A --> A1
                    A --> A2
                    A --> A3
                    A --> A4
                    B --> B1
                    B --> B2
                    B --> B3
                </div>
            </div>
        </section>

        <section id="modules">
            <h2>3. æ ¸å¿ƒæ¨¡å—è®¾è®¡</h2>

            <div id="data-collection" class="module">
                <h3>3.1 ä¼ æ„Ÿå™¨æ•°æ®é‡‡é›†æ¨¡å—</h3>
                <p><strong>åŠŸèƒ½æè¿°ï¼š</strong>é€šè¿‡åä¸ºäº‘IoTå¹³å°è·å–ä¼ æ„Ÿå™¨è®¾å¤‡çš„å®æ—¶æ•°æ®</p>
                
                <div class="flowchart">
                    <div class="mermaid">
                    flowchart TD
                        A[å¼€å§‹æ•°æ®é‡‡é›†] --> B[è·å–è®¤è¯Token]
                        B --> C{Tokenæœ‰æ•ˆ?}
                        C -->|å¦| D[è°ƒç”¨getTokenäº‘å‡½æ•°]
                        D --> E[åä¸ºäº‘IAMè®¤è¯]
                        E --> F[è¿”å›æ–°Token]
                        F --> G[å­˜å‚¨Token]
                        C -->|æ˜¯| H[è°ƒç”¨getDeviceDataäº‘å‡½æ•°]
                        G --> H
                        H --> I[è¯·æ±‚è®¾å¤‡å½±å­æ•°æ®]
                        I --> J[åä¸ºäº‘IoTå¹³å°]
                        J --> K[è§£æå“åº”æ•°æ®]
                        K --> L{æ•°æ®æ ¼å¼æ­£ç¡®?}
                        L -->|å¦| M[è¿”å›é”™è¯¯ä¿¡æ¯]
                        L -->|æ˜¯| N[æå–ä¼ æ„Ÿå™¨æ•°æ®]
                        N --> O[æ•°æ®æ ¼å¼åŒ–]
                        O --> P[ä¿å­˜åˆ°äº‘æ•°æ®åº“]
                        P --> Q[è¿”å›å¤„ç†ç»“æœ]
                        Q --> R[æ›´æ–°å‰ç«¯æ˜¾ç¤º]
                        R --> S[ç»“æŸ]
                        M --> S
                    </flowchart>
                    </div>
                </div>
                
                <div class="data-structure">
                    <h4>å…³é”®è¾“å…¥å‚æ•°ï¼š</h4>
                    <pre>{
  "token": "åä¸ºäº‘è®¤è¯ä»¤ç‰Œ"
}</pre>
                    
                    <h4>å…³é”®è¾“å‡ºæ•°æ®ï¼š</h4>
                    <pre>{
  "code": 0,
  "message": "è®¾å¤‡æ•°æ®è·å–æˆåŠŸ",
  "data": {
    "temperature": 25.6,    // æ¸©åº¦ (Â°C)
    "humidity": 65.2,       // æ¹¿åº¦ (%)
    "PM": 35.8,             // PM2.5æµ“åº¦ (Î¼g/mÂ³)
    "form": 0.08,           // ç”²é†›æµ“åº¦ (mg/mÂ³)
    "voc": 245.3,           // VOCæµ“åº¦ (ppb)
    "uv": 156.7,            // ç´«å¤–çº¿å¼ºåº¦
    "noise": 42.5,          // å™ªéŸ³ (dB)
    "lon": 116.397128,      // ç»åº¦
    "lat": 39.916527,       // çº¬åº¦
    "timestamp": 1703123456789
  }
}</pre>
                </div>
                
                <div class="api-info">
                    <strong>APIç«¯ç‚¹ï¼š</strong> <code>https://c5291326ae.iotda-app.cn-south-4.myhuaweicloud.com/v5/iot/9a8b9ae393844bce8de80dbc4ed08df2/devices/detection_my_air/shadow</code><br>
                    <strong>è¯·æ±‚æ–¹æ³•ï¼š</strong> GET<br>
                    <strong>è®¤è¯æ–¹å¼ï¼š</strong> X-Auth-Token Header
                </div>
            </div>

            <div id="communication" class="module">
                <h3>3.2 æ•°æ®é€šä¿¡æ¨¡å—</h3>
                <p><strong>åŠŸèƒ½æè¿°ï¼š</strong>è´Ÿè´£å‰ç«¯ä¸äº‘æœåŠ¡ã€IoTå¹³å°ä¹‹é—´çš„æ•°æ®é€šä¿¡</p>
                
                <div class="flowchart">
                    <div class="mermaid">
                    sequenceDiagram
                        participant F as å‰ç«¯åº”ç”¨
                        participant C as uniCloud
                        participant H as åä¸ºäº‘IoT
                        participant D as äº‘æ•°æ®åº“
                        
                        F->>C: è°ƒç”¨äº‘å‡½æ•°
                        C->>H: HTTPè¯·æ±‚è®¾å¤‡æ•°æ®
                        H-->>C: è¿”å›JSONå“åº”
                        C->>C: æ•°æ®è§£æä¸éªŒè¯
                        C->>D: ä¿å­˜æ•°æ®åˆ°æ•°æ®åº“
                        D-->>C: ç¡®è®¤ä¿å­˜æˆåŠŸ
                        C-->>F: è¿”å›å¤„ç†ç»“æœ
                        F->>F: æ›´æ–°UIæ˜¾ç¤º
                    </sequenceDiagram>
                    </div>
                </div>
                
                <div class="data-structure">
                    <h4>é€šä¿¡åè®®æ ˆï¼š</h4>
                    <ul>
                        <li><strong>åº”ç”¨å±‚ï¼š</strong> HTTP/HTTPS</li>
                        <li><strong>æ•°æ®æ ¼å¼ï¼š</strong> JSON</li>
                        <li><strong>è®¤è¯æ–¹å¼ï¼š</strong> Token-based Authentication</li>
                        <li><strong>é”™è¯¯å¤„ç†ï¼š</strong> ç»Ÿä¸€é”™è¯¯ç å’Œæ¶ˆæ¯æ ¼å¼</li>
                    </ul>
                </div>
            </div>

            <div id="data-upload" class="module">
                <h3>3.3 æ•°æ®ä¸Šä¼ æ¨¡å—</h3>
                <p><strong>åŠŸèƒ½æè¿°ï¼š</strong>å°†é‡‡é›†åˆ°çš„ä¼ æ„Ÿå™¨æ•°æ®ä¸Šä¼ å¹¶å­˜å‚¨åˆ°äº‘æ•°æ®åº“</p>
                
                <div class="flowchart">
                    <div class="mermaid">
                    flowchart TD
                        A[æ¥æ”¶ä¼ æ„Ÿå™¨æ•°æ®] --> B[æ•°æ®éªŒè¯]
                        B --> C{æ•°æ®å®Œæ•´æ€§æ£€æŸ¥}
                        C -->|å¤±è´¥| D[è®°å½•é”™è¯¯æ—¥å¿—]
                        C -->|æˆåŠŸ| E[æ•°æ®æ ¼å¼åŒ–]
                        E --> F[æ·»åŠ æ—¶é—´æˆ³]
                        F --> G[è¿æ¥äº‘æ•°æ®åº“]
                        G --> H[æ’å…¥æ•°æ®è®°å½•]
                        H --> I{æ’å…¥æˆåŠŸ?}
                        I -->|å¤±è´¥| J[é‡è¯•æœºåˆ¶]
                        J --> K{é‡è¯•æ¬¡æ•°<3?}
                        K -->|æ˜¯| G
                        K -->|å¦| L[è®°å½•å¤±è´¥æ—¥å¿—]
                        I -->|æˆåŠŸ| M[è¿”å›æˆåŠŸçŠ¶æ€]
                        D --> N[ç»“æŸ]
                        L --> N
                        M --> N
                    </flowchart>
                    </div>
                </div>
                
                <div class="data-structure">
                    <h4>æ•°æ®åº“è¡¨ç»“æ„ï¼š</h4>
                    <pre>collection: 'data'
{
  "_id": "è‡ªåŠ¨ç”Ÿæˆçš„æ–‡æ¡£ID",
  "temperature": Number,    // æ¸©åº¦
  "humidity": Number,       // æ¹¿åº¦
  "PM": Number,             // PM2.5
  "form": Number,           // ç”²é†›
  "voc": Number,            // VOC
  "uv": Number,             // ç´«å¤–çº¿
  "noise": Number,          // å™ªéŸ³
  "lon": Number,            // ç»åº¦
  "lat": Number,            // çº¬åº¦
  "timestamp": Number,      // æ—¶é—´æˆ³
  "create_time": Date       // åˆ›å»ºæ—¶é—´
}</pre>
                </div>
            </div>

            <div id="ai-analysis" class="module">
                <h3>3.4 AIé—®ç­”æµç¨‹æ¨¡å—</h3>
                <p><strong>åŠŸèƒ½æè¿°ï¼š</strong>é›†æˆDeepSeek AIæœåŠ¡ï¼Œæä¾›æ™ºèƒ½ç¯å¢ƒåˆ†æå’Œä¸“ä¸šå»ºè®®</p>
                
                <div class="flowchart">
                    <div class="mermaid">
                    flowchart TD
                        A[ç”¨æˆ·å‘èµ·AIåˆ†æ] --> B[é€‰æ‹©æ—¶é—´èŒƒå›´]
                        B --> C[è·å–å†å²æ•°æ®]
                        C --> D[æ•°æ®é¢„å¤„ç†]
                        D --> E[æ„å»ºåˆ†ææç¤ºè¯]
                        E --> F[è°ƒç”¨DeepSeek API]
                        F --> G{æµå¼å“åº”?}
                        G -->|æ˜¯| H[å¤„ç†æµå¼æ•°æ®]
                        G -->|å¦| I[å¤„ç†å®Œæ•´å“åº”]
                        H --> J[å®æ—¶æ˜¾ç¤ºåˆ†æç»“æœ]
                        I --> K[æ‰“å­—æœºæ•ˆæœæ˜¾ç¤º]
                        J --> L[åˆ†æå®Œæˆ]
                        K --> L
                        L --> M[ä¿å­˜å¯¹è¯å†å²]
                        M --> N[ç»“æŸ]
                        
                        subgraph "AIåˆ†æå†…å®¹"
                            E1[ç¯å¢ƒæ•°æ®ç»Ÿè®¡]
                            E2[è¶‹åŠ¿åˆ†æ]
                            E3[å¥åº·å»ºè®®]
                            E4[è®¾å¤‡æ§åˆ¶å»ºè®®]
                        end
                        
                        E --> E1
                        E --> E2
                        E --> E3
                        E --> E4
                    </flowchart>
                    </div>
                </div>
                
                <div class="data-structure">
                    <h4>AIè¯·æ±‚å‚æ•°ï¼š</h4>
                    <pre>{
  "model": "deepseek-chat",
  "messages": [
    {
      "role": "system",
      "content": "ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„æ¸©å®¤æ¤ç‰©å…»æŠ¤ä¸“å®¶..."
    },
    {
      "role": "user",
      "content": "åŸºäºä»¥ä¸‹ç¯å¢ƒæ•°æ®è¿›è¡Œåˆ†æ..."
    }
  ],
  "stream": true,
  "max_tokens": 4096
}</pre>
                    
                    <h4>åˆ†ææç¤ºè¯æ¨¡æ¿ï¼š</h4>
                    <pre>ğŸŒ± **ç¯å¢ƒæ•°æ®åˆ†ææŠ¥å‘Š**
ğŸ“Š **æ•°æ®ç»Ÿè®¡**: [æ—¶é—´èŒƒå›´] å…± [æ•°æ®é‡] æ¡è®°å½•
ğŸŒ¡ï¸ **æ¸©åº¦**: å¹³å‡ [avg]Â°C, æœ€é«˜ [max]Â°C, æœ€ä½ [min]Â°C
ğŸ’§ **æ¹¿åº¦**: å¹³å‡ [avg]%, æœ€é«˜ [max]%, æœ€ä½ [min]%
ğŸŒ«ï¸ **ç”²é†›**: å¹³å‡ [avg]mg/mÂ³, æœ€é«˜ [max]mg/mÂ³
ğŸŒªï¸ **VOC**: å¹³å‡ [avg]ppb, æœ€é«˜ [max]ppb
â˜€ï¸ **ç´«å¤–çº¿**: å¹³å‡ [avg], æœ€é«˜ [max]
ğŸ”Š **å™ªéŸ³**: å¹³å‡ [avg]dB, æœ€é«˜ [max]dB

**è¯·æä¾›ä¸“ä¸šå»ºè®®:**
1. ğŸŒ¡ï¸ **æ¸©æ¹¿åº¦ç®¡ç†**: åˆ†æå½“å‰æ¸©æ¹¿åº¦æ˜¯å¦é€‚å®œ
2. ğŸ’¡ **å…‰ç…§ç®¡ç†**: è¯„ä¼°å…‰ç…§å¼ºåº¦å»ºè®®
3. ğŸ’§ **çŒæº‰ç®¡ç†**: æ ¹æ®ç¯å¢ƒæ¹¿åº¦å»ºè®®
4. ğŸŒ¿ **æ¤ç‰©å¥åº·**: åŸºäºæ•´ä½“ç¯å¢ƒè¯„ä¼°
5. âš¡ **è®¾å¤‡æ§åˆ¶**: å…·ä½“æ“ä½œå»ºè®®
6. ğŸ”® **é¢„é˜²æªæ–½**: åŸºäºè¶‹åŠ¿çš„é¢„é˜²å»ºè®®</pre>
                </div>
                
                <div class="api-info">
                    <strong>AIæœåŠ¡ï¼š</strong> DeepSeek API<br>
                    <strong>APIç«¯ç‚¹ï¼š</strong> <code>https://api.deepseek.com/v1/chat/completions</code><br>
                    <strong>è®¤è¯æ–¹å¼ï¼š</strong> Bearer Token<br>
                    <strong>å“åº”æ ¼å¼ï¼š</strong> æµå¼ (Server-Sent Events) æˆ– å®Œæ•´JSON
                </div>
            </div>

            <div id="alarm-logic" class="module">
                <h3>3.5 æŠ¥è­¦é€»è¾‘æ¨¡å—</h3>
                <p><strong>åŠŸèƒ½æè¿°ï¼š</strong>åŸºäºç¯å¢ƒæ•°æ®é˜ˆå€¼è¿›è¡Œæ™ºèƒ½æŠ¥è­¦å’Œå¥åº·è¯„ä¼°</p>
                
                <div class="flowchart">
                    <div class="mermaid">
                    flowchart TD
                        A[æ¥æ”¶å®æ—¶æ•°æ®] --> B[é˜ˆå€¼æ£€æŸ¥]
                        B --> C{æ¸©åº¦å¼‚å¸¸?}
                        C -->|æ˜¯| D[æ¸©åº¦æŠ¥è­¦]
                        C -->|å¦| E{æ¹¿åº¦å¼‚å¸¸?}
                        E -->|æ˜¯| F[æ¹¿åº¦æŠ¥è­¦]
                        E -->|å¦| G{PM2.5è¶…æ ‡?}
                        G -->|æ˜¯| H[ç©ºæ°”è´¨é‡æŠ¥è­¦]
                        G -->|å¦| I{ç”²é†›è¶…æ ‡?}
                        I -->|æ˜¯| J[ç”²é†›æŠ¥è­¦]
                        I -->|å¦| K{VOCè¶…æ ‡?}
                        K -->|æ˜¯| L[VOCæŠ¥è­¦]
                        K -->|å¦| M{ç´«å¤–çº¿è¿‡å¼º?}
                        M -->|æ˜¯| N[ç´«å¤–çº¿æŠ¥è­¦]
                        M -->|å¦| O{å™ªéŸ³è¿‡å¤§?}
                        O -->|æ˜¯| P[å™ªéŸ³æŠ¥è­¦]
                        O -->|å¦| Q[ç¯å¢ƒæ­£å¸¸]
                        
                        D --> R[è®¡ç®—AQIæŒ‡æ•°]
                        F --> R
                        H --> R
                        J --> R
                        L --> R
                        N --> S[è®¡ç®—UVIæŒ‡æ•°]
                        P --> T[å‘é€é€šçŸ¥]
                        Q --> R
                        R --> S
                        S --> T
                        T --> U[æ›´æ–°UIçŠ¶æ€]
                        U --> V[è®°å½•æŠ¥è­¦æ—¥å¿—]
                        V --> W[ç»“æŸ]
                    </flowchart>
                    </div>
                </div>
                
                <div class="data-structure">
                    <h4>æŠ¥è­¦é˜ˆå€¼é…ç½®ï¼š</h4>
                    <pre>const ALARM_THRESHOLDS = {
  temperature: {
    min: 16,      // æœ€ä½æ¸©åº¦ (Â°C)
    max: 30,      // æœ€é«˜æ¸©åº¦ (Â°C)
    optimal: [20, 26]  // æœ€é€‚æ¸©åº¦èŒƒå›´
  },
  humidity: {
    min: 40,      // æœ€ä½æ¹¿åº¦ (%)
    max: 70,      // æœ€é«˜æ¹¿åº¦ (%)
    optimal: [50, 60]  // æœ€é€‚æ¹¿åº¦èŒƒå›´
  },
  PM25: {
    good: 35,     // ä¼˜ (Î¼g/mÂ³)
    moderate: 75, // è‰¯
    unhealthy: 115 // è½»åº¦æ±¡æŸ“
  },
  formaldehyde: {
    safe: 0.1,    // å®‰å…¨å€¼ (mg/mÂ³)
    warning: 0.3, // è­¦å‘Šå€¼
    danger: 0.5   // å±é™©å€¼
  },
  voc: {
    good: 300,    // è‰¯å¥½ (ppb)
    moderate: 1000, // ä¸­ç­‰
    poor: 3000    // å·®
  },
  uv: {
    low: 2,       // ä½
    moderate: 5,  // ä¸­ç­‰
    high: 7,      // é«˜
    veryHigh: 10  // å¾ˆé«˜
  },
  noise: {
    quiet: 40,    // å®‰é™ (dB)
    normal: 55,   // æ­£å¸¸
    loud: 70      // åµé—¹
  }
};</pre>
                    
                    <h4>AQIè®¡ç®—å…¬å¼ï¼š</h4>
                    <pre>// PM2.5çš„AQIè®¡ç®—ï¼ˆç®€åŒ–ç‰ˆï¼‰
function calculatePM25AQI(pm25) {
  if (pm25 <= 35) {
    return pm25 * 50 / 35;
  } else if (pm25 <= 75) {
    return 50 + (pm25 - 35) * 50 / 40;
  } else if (pm25 <= 115) {
    return 100 + (pm25 - 75) * 50 / 40;
  } else if (pm25 <= 150) {
    return 150 + (pm25 - 115) * 50 / 35;
  } else if (pm25 <= 250) {
    return 200 + (pm25 - 150) * 100 / 100;
  } else {
    return 300 + (pm25 - 250) * 200 / 250;
  }
}</pre>
                </div>
            </div>

            <div id="chart-display" class="module">
                <h3>3.6 å›¾è¡¨æ˜¾ç¤ºæ¨¡å—</h3>
                <p><strong>åŠŸèƒ½æè¿°ï¼š</strong>ä½¿ç”¨qiun-data-chartsç»„ä»¶åº“å®ç°å¤šç»´åº¦æ•°æ®å¯è§†åŒ–</p>
                
                <div class="flowchart">
                    <div class="mermaid">
                    flowchart TD
                        A[ç”¨æˆ·é€‰æ‹©å›¾è¡¨ç±»å‹] --> B[è®¾ç½®æ—¶é—´èŒƒå›´]
                        B --> C[è°ƒç”¨getHistoryData]
                        C --> D[è·å–å†å²æ•°æ®]
                        D --> E[æ•°æ®æ ¼å¼è½¬æ¢]
                        E --> F{æ•°æ®ç±»å‹?}
                        F -->|å•ä¸€ç±»å‹| G[æ„å»ºå•ç»´å›¾è¡¨æ•°æ®]
                        F -->|å…¨éƒ¨ç±»å‹| H[æ„å»ºå¤šç»´å›¾è¡¨æ•°æ®]
                        G --> I[é…ç½®å›¾è¡¨é€‰é¡¹]
                        H --> I
                        I --> J[æ¸²æŸ“å›¾è¡¨ç»„ä»¶]
                        J --> K[æ˜¾ç¤ºå›¾è¡¨]
                        K --> L{ç”¨æˆ·äº¤äº’?}
                        L -->|æ˜¯| M[å¤„ç†äº¤äº’äº‹ä»¶]
                        L -->|å¦| N[ç­‰å¾…ç”¨æˆ·æ“ä½œ]
                        M --> O[æ›´æ–°å›¾è¡¨æ˜¾ç¤º]
                        O --> N
                        N --> P[ç»“æŸ]
                        
                        subgraph "å›¾è¡¨ç±»å‹"
                            T1[æŠ˜çº¿å›¾ - è¶‹åŠ¿åˆ†æ]
                            T2[æŸ±çŠ¶å›¾ - æ•°æ®å¯¹æ¯”]
                            T3[é¢ç§¯å›¾ - æ•°æ®åˆ†å¸ƒ]
                            T4[æ··åˆå›¾ - å¤šç»´å±•ç¤º]
                        end
                        
                        I --> T1
                        I --> T2
                        I --> T3
                        I --> T4
                    </flowchart>
                    </div>
                </div>
                
                <div class="data-structure">
                    <h4>å›¾è¡¨é…ç½®ç»“æ„ï¼š</h4>
                    <pre>const chartOptions = {
  type: 'line',           // å›¾è¡¨ç±»å‹
  fontSize: 11,           // å­—ä½“å¤§å°
  background: 'none',     // èƒŒæ™¯è‰²
  pixelRatio: 1,         // åƒç´ æ¯”
  animation: true,        // åŠ¨ç”»æ•ˆæœ
  enableScroll: true,     // æ»šåŠ¨ç¼©æ”¾
  enableMarkLine: true,   // æ ‡è®°çº¿
  dataLabel: false,       // æ•°æ®æ ‡ç­¾
  dataPointShape: true,   // æ•°æ®ç‚¹å½¢çŠ¶
  connectNulls: false,    // è¿æ¥ç©ºå€¼
  xAxis: {
    disableGrid: false,   // ç½‘æ ¼çº¿
    type: 'datetime',     // æ—¶é—´è½´
    gridType: 'dash',     // ç½‘æ ¼ç±»å‹
    dashLength: 8         // è™šçº¿é•¿åº¦
  },
  yAxis: {
    gridType: 'dash',
    dashLength: 8,
    splitNumber: 5,       // åˆ†å‰²æ•°é‡
    min: 0,              // æœ€å°å€¼
    max: 'auto'          // æœ€å¤§å€¼
  },
  legend: {
    show: true,          // æ˜¾ç¤ºå›¾ä¾‹
    position: 'bottom',  // ä½ç½®
    lineHeight: 25       // è¡Œé«˜
  },
  extra: {
    line: {
      type: 'curve',     // æ›²çº¿ç±»å‹
      width: 2,          // çº¿å®½
      activeType: 'hollow' // æ¿€æ´»ç±»å‹
    }
  }
};</pre>
                    
                    <h4>æ•°æ®æ ¼å¼è½¬æ¢ï¼š</h4>
                    <pre>// å†å²æ•°æ®è½¬å›¾è¡¨æ•°æ®
function formatChartData(historyData, dataType) {
  const categories = [];
  const series = [];
  
  if (dataType === 'all') {
    // å¤šç»´æ•°æ®å¤„ç†
    const dataTypes = ['temperature', 'humidity', 'formaldehyde', 'voc', 'uv', 'noise'];
    
    dataTypes.forEach(type => {
      if (historyData[type] && historyData[type].length > 0) {
        const data = historyData[type].map(item => item.value);
        const times = historyData[type].map(item => item.time);
        
        if (categories.length === 0) {
          categories.push(...times);
        }
        
        series.push({
          name: getDataTypeName(type),
          data: data
        });
      }
    });
  } else {
    // å•ä¸€æ•°æ®å¤„ç†
    const data = historyData.map(item => item.value);
    const times = historyData.map(item => item.time);
    
    categories.push(...times);
    series.push({
      name: getDataTypeName(dataType),
      data: data
    });
  }
  
  return { categories, series };
}</pre>
                </div>
            </div>
        </section>

        <section id="data-structures">
            <h2>4. æ•°æ®ç»“æ„å®šä¹‰</h2>
            
            <div class="data-structure">
                <h3>4.1 ä¼ æ„Ÿå™¨æ•°æ®ç»“æ„</h3>
                <pre>interface SensorData {
  temperature: number;    // æ¸©åº¦ (Â°C)
  humidity: number;       // æ¹¿åº¦ (%)
  PM: number;            // PM2.5æµ“åº¦ (Î¼g/mÂ³)
  form: number;          // ç”²é†›æµ“åº¦ (mg/mÂ³)
  voc: number;           // VOCæµ“åº¦ (ppb)
  uv: number;            // ç´«å¤–çº¿å¼ºåº¦
  noise: number;         // å™ªéŸ³ (dB)
  lon: number;           // ç»åº¦
  lat: number;           // çº¬åº¦
  timestamp: number;     // æ—¶é—´æˆ³
}</pre>
                
                <h3>4.2 APIå“åº”ç»“æ„</h3>
                <pre>interface ApiResponse<T> {
  code: number;          // çŠ¶æ€ç  (0:æˆåŠŸ, -1:å¤±è´¥, 401:æœªæˆæƒ)
  message: string;       // å“åº”æ¶ˆæ¯
  data: T | null;        // å“åº”æ•°æ®
}</pre>
                
                <h3>4.3 å†å²æ•°æ®æŸ¥è¯¢å‚æ•°</h3>
                <pre>interface HistoryQuery {
  startTime: number;     // å¼€å§‹æ—¶é—´æˆ³
  endTime: number;       // ç»“æŸæ—¶é—´æˆ³
  dataType: string;      // æ•°æ®ç±»å‹ ('all' | 'temperature' | 'humidity' | ...)
}</pre>
                
                <h3>4.4 AIå¯¹è¯æ•°æ®ç»“æ„</h3>
                <pre>interface ChatMessage {
  role: 'user' | 'assistant' | 'system';  // è§’è‰²
  content: string;                         // æ¶ˆæ¯å†…å®¹
  timestamp?: number;                      // æ—¶é—´æˆ³
  ds_loading?: boolean;                    // åŠ è½½çŠ¶æ€
}</pre>
            </div>
        </section>

        <section id="api-interfaces">
            <h2>5. APIæ¥å£è®¾è®¡</h2>
            
            <div class="api-info">
                <h3>5.1 äº‘å‡½æ•°æ¥å£</h3>
                
                <h4>getToken - è·å–è®¤è¯ä»¤ç‰Œ</h4>
                <ul>
                    <li><strong>åŠŸèƒ½ï¼š</strong>è·å–åä¸ºäº‘IoTå¹³å°è®¤è¯Token</li>
                    <li><strong>å‚æ•°ï¼š</strong>æ— </li>
                    <li><strong>è¿”å›ï¼š</strong>ApiResponse&lt;{token: string, timestamp: number}&gt;</li>
                </ul>
                
                <h4>getDeviceData - è·å–è®¾å¤‡æ•°æ®</h4>
                <ul>
                    <li><strong>åŠŸèƒ½ï¼š</strong>è·å–è®¾å¤‡å®æ—¶æ•°æ®å¹¶ä¿å­˜åˆ°æ•°æ®åº“</li>
                    <li><strong>å‚æ•°ï¼š</strong>{token: string}</li>
                    <li><strong>è¿”å›ï¼š</strong>ApiResponse&lt;SensorData&gt;</li>
                </ul>
                
                <h4>getHistoryData - è·å–å†å²æ•°æ®</h4>
                <ul>
                    <li><strong>åŠŸèƒ½ï¼š</strong>æŸ¥è¯¢æŒ‡å®šæ—¶é—´æ®µçš„å†å²æ•°æ®</li>
                    <li><strong>å‚æ•°ï¼š</strong>HistoryQuery</li>
                    <li><strong>è¿”å›ï¼š</strong>ApiResponse&lt;{total: number, list: any, timeRange: object}&gt;</li>
                </ul>
            </div>
            
            <div class="api-info">
                <h3>5.2 å¤–éƒ¨APIæ¥å£</h3>
                
                <h4>åä¸ºäº‘IoTè®¾å¤‡å½±å­API</h4>
                <ul>
                    <li><strong>URLï¼š</strong>https://c5291326ae.iotda-app.cn-south-4.myhuaweicloud.com/v5/iot/{project_id}/devices/{device_id}/shadow</li>
                    <li><strong>æ–¹æ³•ï¼š</strong>GET</li>
                    <li><strong>è®¤è¯ï¼š</strong>X-Auth-Token</li>
                    <li><strong>å“åº”ï¼š</strong>è®¾å¤‡å½±å­æ•°æ®JSON</li>
                </ul>
                
                <h4>DeepSeek AI API</h4>
                <ul>
                    <li><strong>URLï¼š</strong>https://api.deepseek.com/v1/chat/completions</li>
                    <li><strong>æ–¹æ³•ï¼š</strong>POST</li>
                    <li><strong>è®¤è¯ï¼š</strong>Bearer Token</li>
                    <li><strong>æ”¯æŒï¼š</strong>æµå¼å“åº” (Server-Sent Events)</li>
                </ul>
            </div>
        </section>

        <section id="tech-stack">
            <h2>6. æŠ€æœ¯æ ˆè¯¦è§£</h2>
            
            <div class="tech-stack">
                <div class="tech-item">
                    <h4>ğŸ¯ å‰ç«¯æ¡†æ¶</h4>
                    <p><strong>UniApp (Vue.js 2)</strong></p>
                    <ul>
                        <li>è·¨å¹³å°å¼€å‘æ¡†æ¶</li>
                        <li>æ”¯æŒå°ç¨‹åºã€H5ã€App</li>
                        <li>Vue.jsè¯­æ³•å’Œç”Ÿæ€</li>
                    </ul>
                </div>
                
                <div class="tech-item">
                    <h4>ğŸ¨ UIç»„ä»¶åº“</h4>
                    <p><strong>ColorUI</strong></p>
                    <ul>
                        <li>è½»é‡çº§CSSæ¡†æ¶</li>
                        <li>ä¸°å¯Œçš„ç»„ä»¶æ ·å¼</li>
                        <li>å“åº”å¼è®¾è®¡</li>
                    </ul>
                </div>
                
                <div class="tech-item">
                    <h4>ğŸ“Š å›¾è¡¨ç»„ä»¶</h4>
                    <p><strong>qiun-data-charts</strong></p>
                    <ul>
                        <li>åŸºäºuCharts.js</li>
                        <li>æ”¯æŒå¤šç§å›¾è¡¨ç±»å‹</li>
                        <li>äº¤äº’å¼æ•°æ®å¯è§†åŒ–</li>
                    </ul>
                </div>
                
                <div class="tech-item">
                    <h4>â˜ï¸ äº‘æœåŠ¡</h4>
                    <p><strong>uniCloud</strong></p>
                    <ul>
                        <li>Serverlessäº‘å¼€å‘</li>
                        <li>äº‘å‡½æ•°è®¡ç®—</li>
                        <li>äº‘æ•°æ®åº“å­˜å‚¨</li>
                    </ul>
                </div>
                
                <div class="tech-item">
                    <h4>ğŸŒ IoTå¹³å°</h4>
                    <p><strong>åä¸ºäº‘IoT</strong></p>
                    <ul>
                        <li>è®¾å¤‡æ¥å…¥ç®¡ç†</li>
                        <li>è®¾å¤‡å½±å­æœåŠ¡</li>
                        <li>æ•°æ®é‡‡é›†ä¸å¤„ç†</li>
                    </ul>
                </div>
                
                <div class="tech-item">
                    <h4>ğŸ¤– AIæœåŠ¡</h4>
                    <p><strong>DeepSeek API</strong></p>
                    <ul>
                        <li>å¤§è¯­è¨€æ¨¡å‹</li>
                        <li>æµå¼å“åº”æ”¯æŒ</li>
                        <li>ä¸“ä¸šé¢†åŸŸåˆ†æ</li>
                    </ul>
                </div>
                
                <div class="tech-item">
                    <h4>ğŸ—ºï¸ åœ°å›¾æœåŠ¡</h4>
                    <p><strong>å¾®ä¿¡å°ç¨‹åºåœ°å›¾API</strong></p>
                    <ul>
                        <li>ä½ç½®æ˜¾ç¤º</li>
                        <li>æ ‡è®°ç‚¹ç®¡ç†</li>
                        <li>åœ°å›¾äº¤äº’</li>
                    </ul>
                </div>
                
                <div class="tech-item">
                    <h4>ğŸ”§ å¼€å‘å·¥å…·</h4>
                    <p><strong>HBuilderX</strong></p>
                    <ul>
                        <li>UniAppå®˜æ–¹IDE</li>
                        <li>ä»£ç æç¤ºä¸è°ƒè¯•</li>
                        <li>å¤šç«¯å‘å¸ƒ</li>
                    </ul>
                </div>
            </div>
        </section>

        <div class="warning">
            <h3>âš ï¸ æ³¨æ„äº‹é¡¹</h3>
            <ul>
                <li><strong>å®‰å…¨æ€§ï¼š</strong>æ‰€æœ‰APIå¯†é’¥å’Œæ•æ„Ÿä¿¡æ¯åº”å­˜å‚¨åœ¨äº‘å‡½æ•°ä¸­ï¼Œé¿å…åœ¨å‰ç«¯æš´éœ²</li>
                <li><strong>æ€§èƒ½ä¼˜åŒ–ï¼š</strong>å¤§é‡å†å²æ•°æ®æŸ¥è¯¢æ—¶åº”å®ç°åˆ†é¡µå’Œç¼“å­˜æœºåˆ¶</li>
                <li><strong>é”™è¯¯å¤„ç†ï¼š</strong>ç½‘ç»œå¼‚å¸¸ã€æ•°æ®æ ¼å¼é”™è¯¯ç­‰æƒ…å†µéœ€è¦å®Œå–„çš„é”™è¯¯å¤„ç†æœºåˆ¶</li>
                <li><strong>æ•°æ®ä¸€è‡´æ€§ï¼š</strong>å‰ç«¯å­—æ®µåç§°å¿…é¡»ä¸äº‘å‡½æ•°è¿”å›çš„æ•°æ®ç»“æ„ä¿æŒä¸€è‡´</li>
                <li><strong>å®æ—¶æ€§ï¼š</strong>è€ƒè™‘å®ç°WebSocketæˆ–å®šæ—¶è½®è¯¢æœºåˆ¶æé«˜æ•°æ®å®æ—¶æ€§</li>
            </ul>
        </div>
        
        <div class="success">
            <h3>âœ… ç³»ç»Ÿä¼˜åŠ¿</h3>
            <ul>
                <li><strong>è·¨å¹³å°å…¼å®¹ï¼š</strong>ä¸€å¥—ä»£ç æ”¯æŒå¤šç«¯è¿è¡Œ</li>
                <li><strong>äº‘åŸç”Ÿæ¶æ„ï¼š</strong>Serverlessæ¶æ„ï¼Œå¼¹æ€§æ‰©å±•</li>
                <li><strong>æ™ºèƒ½åˆ†æï¼š</strong>AIé©±åŠ¨çš„ä¸“ä¸šç¯å¢ƒåˆ†æ</li>
                <li><strong>å®æ—¶ç›‘æ§ï¼š</strong>å¤šç»´åº¦ç¯å¢ƒå‚æ•°å®æ—¶ç›‘æµ‹</li>
                <li><strong>å¯è§†åŒ–å±•ç¤ºï¼š</strong>ä¸°å¯Œçš„å›¾è¡¨å’Œæ•°æ®å¯è§†åŒ–</li>
            </ul>
        </div>
    </div>
    
    <script>
        // åˆå§‹åŒ–Mermaid
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default',
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true
            },
            sequence: {
                useMaxWidth: true,
                wrap: true
            }
        });
    </script>
</body>
</html>